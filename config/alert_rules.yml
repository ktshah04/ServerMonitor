# AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
# This file is generated by generate_alerts.py
# To make changes, edit config/alerts_config.json and run: python3 generate_alerts.py

apiVersion: 1
groups:
- orgId: 1
  name: server_monitoring_alerts
  folder: Server Monitoring
  interval: 10s
  rules:
  - uid: cpu-usage-alert
    title: CPU Usage Alert
    condition: C
    data:
    - refId: A
      relativeTimeRange:
        from: 600
        to: 0
      datasourceUid: prometheus
      model:
        expr: 100 - (avg by(instance, hostname) (irate(node_cpu_seconds_total{mode="idle"}[5m]))
          * 100)
        interval: ''
        refId: A
        datasource:
          type: prometheus
          uid: prometheus
    - refId: B
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        expression: A
        reducer: last
        refId: B
        type: reduce
    - refId: C
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        conditions:
        - evaluator:
            params:
            - 95
            type: gt
          operator:
            type: and
          query:
            params:
            - B
          type: query
        expression: B
        refId: C
        type: threshold
    noDataState: NoData
    execErrState: Alerting
    for: 10m
    annotations:
      summary: CPU usage has been above 95% for 10m
      description: CPU usage has exceeded 95% for 10m
    labels:
      alert_type: system
    isPaused: false
  - uid: memory-usage-alert
    title: Memory Usage Alert
    condition: C
    data:
    - refId: A
      relativeTimeRange:
        from: 600
        to: 0
      datasourceUid: prometheus
      model:
        expr: 100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
        interval: ''
        refId: A
        datasource:
          type: prometheus
          uid: prometheus
    - refId: B
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        expression: A
        reducer: last
        refId: B
        type: reduce
    - refId: C
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        conditions:
        - evaluator:
            params:
            - 95
            type: gt
          operator:
            type: and
          query:
            params:
            - B
          type: query
        expression: B
        refId: C
        type: threshold
    noDataState: NoData
    execErrState: Alerting
    for: 10m
    annotations:
      summary: Memory usage has been above 95% for 10m
      description: Memory usage has exceeded 95% for 10m
    labels:
      alert_type: system
    isPaused: false
  - uid: storage-alert-physical-drives
    title: Storage Alert
    condition: C
    data:
    - refId: A
      relativeTimeRange:
        from: 600
        to: 0
      datasourceUid: prometheus
      model:
        expr: 100 * (1 - (node_filesystem_avail_bytes{mountpoint=~"^/rootfs$|/rootfs/home$|/rootfs/mnt/data[0-9]+$",fstype!="tmpfs"}
          / node_filesystem_size_bytes{mountpoint=~"^/rootfs$|/rootfs/home$|/rootfs/mnt/data[0-9]+$",fstype!="tmpfs"}))
        interval: ''
        refId: A
        datasource:
          type: prometheus
          uid: prometheus
    - refId: B
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        expression: A
        reducer: last
        refId: B
        type: reduce
    - refId: C
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        conditions:
        - evaluator:
            params:
            - 90
            type: gt
          operator:
            type: and
          query:
            params:
            - B
          type: query
        expression: B
        refId: C
        type: threshold
    noDataState: NoData
    execErrState: Alerting
    for: 10s
    annotations:
      summary: Drive is more than 90% full
      description: ''
    labels:
      alert_type: storage
    isPaused: false
  - uid: storage-projection-alert
    title: Storage Projection Alert
    condition: C
    data:
    - refId: A
      relativeTimeRange:
        from: 600
        to: 0
      datasourceUid: prometheus
      model:
        expr: predict_linear(node_filesystem_avail_bytes{mountpoint=~"^/rootfs$|/rootfs/home$|/rootfs/mnt/data[0-9]+$",fstype!="tmpfs"}[7d],
          2592000)
        interval: ''
        refId: A
        datasource:
          type: prometheus
          uid: prometheus
    - refId: B
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        expression: A
        reducer: last
        refId: B
        type: reduce
    - refId: C
      relativeTimeRange:
        from: 0
        to: 0
      datasourceUid: '-100'
      model:
        datasource:
          type: __expr__
          uid: '-100'
        conditions:
        - evaluator:
            params:
            - 0
            type: lt
          operator:
            type: and
          query:
            params:
            - B
          type: query
        expression: B
        refId: C
        type: threshold
    noDataState: NoData
    execErrState: Alerting
    for: 1h
    annotations:
      summary: Drive projected to fill within 30 days
      description: Based on 7d usage trend, drive is projected to run out of space
        within 30 days
    labels:
      alert_type: storage_projection
    isPaused: false
